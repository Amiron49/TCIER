using UnityEngine;

public class InvulnerabilityOnLifeLoss : MonoBehaviour
{
	public float duration = 1;
	public float cooldown = 0;
	private Life _live;
	public Material blinkMaterial;
	private Material _oldMaterial;
	private SpriteRenderer _renderer;
	public GameObject objectWithRenderer;

	// Start is called before the first frame update
	void Start()
	{
		_renderer = objectWithRenderer.GetComponent<SpriteRenderer>();
		_live = GetComponent<Life>();
		_live.OnDamageTaken += (sender, source) =>
		{
			_live.invincible = true;
			_oldMaterial = _renderer.material;
			_renderer.material = blinkMaterial;
			cooldown = duration;
		};
	}

	// Update is called once per frame
	void Update()
	{
		if (cooldown <= 0 || Game.Instance.State.GameTime.Paused)
			return;

		cooldown -= Game.Instance.State.GameTime.DeltaTime;

		if (cooldown <= 0)
		{
			_renderer.material = _oldMaterial;
			_live.invincible = false;
		}
	}
}